---
import BaseLayout from '@/layouts/BaseLayout.astro';
import SectionHeader from '@/components/SectionHeader.astro';
import Button from '@/components/Button.astro';
import siteData from '@/data/site.json';
import { getCollection } from 'astro:content';

const portfolio = await getCollection('portfolio');
const sortedPortfolio = portfolio.sort((a, b) => (a.data.order || 0) - (b.data.order || 0));
const { sections } = siteData;

// Group by industry if desired
const industries = [...new Set(portfolio.map(p => p.data.industry).filter(Boolean))];
---

<BaseLayout title="Portfolio">
  <!-- Hero -->
  <section class="pt-28 pb-16 bg-gradient-to-b from-sand-50 to-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl">
        <span class="text-sm font-semibold text-primary-600 uppercase tracking-wider">Work</span>
        <h1 class="mt-3 font-display text-4xl sm:text-5xl lg:text-6xl font-bold text-slate-900 leading-tight">
          {sections.portfolio?.headline || "Selected work"}
        </h1>
        {sections.portfolio?.description && (
          <p class="mt-6 text-xl text-slate-600 leading-relaxed">
            {sections.portfolio.description}
          </p>
        )}
      </div>
    </div>
  </section>

  <!-- Portfolio Grid -->
  <section class="py-20 bg-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      {sortedPortfolio.length > 0 ? (
        <div class="grid md:grid-cols-2 gap-10">
          {sortedPortfolio.map((project) => (
            <a 
              href={`/portfolio/${project.slug}`}
              class="group block"
            >
              <div class="aspect-[16/10] rounded-2xl overflow-hidden bg-gradient-to-br from-slate-100 to-slate-50 mb-6">
                {project.data.coverImage ? (
                  <img 
                    src={project.data.coverImage} 
                    alt={project.data.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  />
                ) : (
                  <div class="w-full h-full flex items-center justify-center">
                    <svg class="w-20 h-20 text-slate-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                )}
              </div>
              
              <div class="flex items-center gap-3 mb-3">
                {project.data.industry && (
                  <span class="text-xs font-semibold text-primary-600 uppercase tracking-wider">
                    {project.data.industry}
                  </span>
                )}
                {project.data.client && (
                  <>
                    <span class="text-slate-300">â€¢</span>
                    <span class="text-sm text-slate-500">{project.data.client}</span>
                  </>
                )}
              </div>
              
              <h2 class="font-display text-2xl font-bold text-slate-900 group-hover:text-primary-700 transition-colors">
                {project.data.title}
              </h2>
              
              <p class="mt-3 text-slate-600 leading-relaxed line-clamp-2">
                {project.data.excerpt}
              </p>
              
              {project.data.services && project.data.services.length > 0 && (
                <div class="mt-4 flex flex-wrap gap-2">
                  {project.data.services.slice(0, 3).map((service) => (
                    <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-600">
                      {service}
                    </span>
                  ))}
                </div>
              )}
              
              <div class="mt-5 inline-flex items-center text-sm font-semibold text-primary-600 group-hover:text-primary-700">
                Read case study
                <svg class="ml-1 w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                </svg>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <svg class="mx-auto w-16 h-16 text-slate-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <h3 class="mt-4 font-display text-xl font-bold text-slate-900">No case studies yet</h3>
          <p class="mt-2 text-slate-600">Check back soon for examples of our work.</p>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-20 bg-sand-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="font-display text-3xl sm:text-4xl font-bold text-slate-900">
        Ready to build your own success story?
      </h2>
      <p class="mt-4 text-lg text-slate-600">
        Let's talk about what you're building and how we can help.
      </p>
      <div class="mt-8 flex flex-wrap justify-center gap-4">
        <Button href="/contact" style="primary" size="lg">
          Start a conversation
        </Button>
        <Button href="/services" style="outline" size="lg">
          View our capabilities
        </Button>
      </div>
    </div>
  </section>
</BaseLayout>
